import{k as pe,al as A,G as ve,am as fe,I as ge,g as he,r as w,c as T,an as ye,K as be,ao as Ve,L as _e,ap as Pe,w as F,p as L,u as R,z as W,aq as we,h as Z,ar as Se,l as Ie,E as qe,d as Te,Z as ke,o as Ue,O as Ce,R as Oe,S as M,_ as xe,U as y,f as n,$ as z,a0 as o,a1 as Ee,a2 as De,ab as G,a3 as c,ac as Ae,F as Me,a5 as q,a6 as N,Y as Ne,a4 as Qe}from "./index-CLxRvZYn.js";import{v as $e,i as K,u as Be,p as Y,j as He,k as je,l as Fe,r as J,s as Le,c as X,e as ee}from "./QSelect-BUHZvF4Q.js";import{Q as Re}from "./QForm-BGxHd8hi.js";import{api as te}from "./axios-DLpAuOl3.js";import{u as We}from "./use-quasar-DkPXY9po.js";import{u as Ze,e as le}from "./MainLayout-store-C26opbpP.js";import{_ as ze}from "./_plugin-vue_export-helper-DlAUqK2U.js";const Ut=pe({name:"QTooltip",inheritAttrs:!1,props:{...Be,...ge,...A,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...A.transitionShow,default:"jump-down"},transitionHide:{...A.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:K},self:{type:String,default:"top middle",validator:K},offset:{type:Array,default:()=>[14,14],validator:$e},scrollTarget:fe,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...ve],setup(r, {slots:O,emit:P,attrs:a}){let m,p;const f=he(),{proxy:{$q:u}}=f,g=w(null),b=w(!1),k=T(()=>Y(r.anchor,u.lang.rtl)),V=T(()=>Y(r.self,u.lang.rtl)),x=T(()=>r.persistent!==!0),{registerTick:U,removeTick:C}=ye(),{registerTimeout:h}=be(),{transitionProps:d,transitionStyle:l}=Ve(r),{localScrollTarget:e,changeScrollEvent:s,unconfigureScrollTarget:t}=He(r,H),{anchorEl:v,canShow:oe,anchorEvents:S}=je({showing:b,configureAnchorEl:ue}),{show:ae,hide:E}=_e({showing:b,canShow:oe,handleShow:ne,handleHide:re,hideOnRouteChange:x,processOnMount:!0});Object.assign(S,{delayShow:de,delayHide:ie});const{showPortal:Q,hidePortal:$,renderPortal:se}=Pe(f,g,me,"tooltip");if(u.platform.is.mobile===!0){const i={anchorEl:v,innerRef:g,onClickOutside(_){return E(_),_.target.classList.contains("q-dialog__backdrop")&&qe(_),!0}},D=T(()=>r.modelValue===null&&r.persistent!==!0&&b.value===!0);F(D, _=>{(_===!0?Fe:J)(i)}),L(()=>{J(i)})}function ne(i){Q(),U(()=>{p=new MutationObserver(()=>I()),p.observe(g.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),I(),H()}),m===void 0&&(m=F(()=>u.screen.width+"|"+u.screen.height+"|"+r.self+"|"+r.anchor+"|"+u.lang.rtl,I)),h(()=>{Q(!0),P("show",i)},r.transitionDuration)}function re(i){C(),$(),B(),h(()=>{$(!0),P("hide",i)},r.transitionDuration)}function B(){p!==void 0&&(p.disconnect(),p=void 0),m!==void 0&&(m(),m=void 0),t(),R(S,"tooltipTemp")}function I(){Le({targetEl:g.value,offset:r.offset,anchorEl:v.value,anchorOrigin:k.value,selfOrigin:V.value,maxHeight:r.maxHeight,maxWidth:r.maxWidth})}function de(i){if(u.platform.is.mobile===!0){X(),document.body.classList.add("non-selectable");const D=v.value,_=["touchmove","touchcancel","touchend","click"].map(j=>[D,j,"delayHide","passiveCapture"]);W(S,"tooltipTemp",_)}h(()=>{ae(i)},r.delay)}function ie(i){u.platform.is.mobile===!0&&(R(S,"tooltipTemp"),X(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),h(()=>{E(i)},r.hideDelay)}function ue(){if(r.noParentEvent===!0||v.value===null)return;const i=u.platform.is.mobile===!0?[[v.value,"touchstart","delayShow","passive"]]:[[v.value,"mouseenter","delayShow","passive"],[v.value,"mouseleave","delayHide","passive"]];W(S,"anchor",i)}function H(){if(v.value!==null||r.scrollTarget!==void 0){e.value=we(v.value,r.scrollTarget);const i=r.noParentEvent===!0?I:E;s(e.value,i)}}function ce(){return b.value===!0?Z("div",{...a,ref:g,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",a.class],style:[a.style,l.value],role:"tooltip"},Ie(O.default)):null}function me(){return Z(Se,d.value,ce)}return L(B),Object.assign(f.proxy,{updatePosition:I}),se}}),Ge={class:"row q-gutter-sm"},Ke={class:"col-12 col-sm-6 col-md-4"},Ye={class:"col-12 col-sm-6 col-md-4"},Je={class:"col-12 col-md-4"},Xe={class:"row"},et={class:"col-12"},tt={class:"row q-gutter-sm"},lt={class:"col-12 col-sm-6"},ot={class:"col-12 col-sm-6"},at={class:"lt-sm"},st={class:"q-mb-sm"},nt={class:"row q-gutter-sm q-mb-sm"},rt={class:"col-6"},dt={class:"col-6"},it={class:"row q-gutter-sm items-center"},ut={class:"col-8"},ct={class:"col-4 flex justify-center"},mt={class:"gt-xs"},pt={class:"row q-gutter-sm items-end"},vt={class:"col-12 col-sm-5 col-md-4"},ft={class:"col-4 col-sm-2"},gt={class:"col-4 col-sm-2"},ht={class:"col-4 col-sm-2"},yt={class:"col-12 col-sm-1 flex justify-center items-end",style:{"padding-bottom":"18px"}},bt={class:"row justify-end"},Vt={class:"text-h6 text-primary"},_t=Te({__name:"ShippingForm",props:{modelValue:{type:[Boolean,null],default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(r){const O=Ze(),P=We(),a=w({orderDate:new Date().toISOString().split("T")[0],customerName:"",customerPhone:"",customerEmail:"",customerAddress:"",orderStatus:"pending",notes:"",orderItems:[{productId:null,productName:"",productSku:"",quantity:1,salePrice:0,totalPrice:0}]}),m=w([]),p=w(),f=w(!1),u=ke(r,"modelValue"),g=T(()=>a.value.orderItems.reduce((d, l)=>d+(l.totalPrice||0),0));Ue(async()=>{await b(),h(),le.on("product-added",()=>{b()})});async function b(){try{const{data:d}=await te.get("/saleOrder/products");m.value=d}catch(d){console.log("獲取商品列表失敗",d)}}function k(d, l){const e=m.value.find(s=>s.productId===l);if(e){const s=a.value.orderItems[d];s&&(s.productName=e.name,s.salePrice=e.price,V(d))}}function V(d){const l=a.value.orderItems[d];l&&(l.totalPrice=(l.quantity||0)*(l.salePrice||0))}function x(){a.value.orderItems.push({productId:null,productName:"",productSku:"",quantity:1,salePrice:0,totalPrice:0})}function U(d){a.value.orderItems.length>1&&a.value.orderItems.splice(d,1)}async function C(){if(!await p.value?.validate?.())return;if(a.value.orderItems.some(s=>!s.productId)){P.notify({color:"negative",message:"請選擇所有商品項目",icon:"warning",position:"top"});return}f.value=!0;const e={...a.value,totalAmount:g.value,orderItems:a.value.orderItems.map(s=>({productId:s.productId,productName:s.productName,productSku:s.productSku,quantity:s.quantity,salePrice:s.salePrice}))};console.log("送出資料:",e);try{await te.post("/saleOrder",e),P.notify({color:"positive",message:"已新增出貨單",icon:"done",position:"top"}),u.value=!1,O.incrementOrdersBadge(),h(),le.emit("sale-order-added")}catch(s){console.error("送出失敗",s),P.notify({color:"negative",message:"送出失敗，請稍後再試",icon:"error",position:"top"})}finally{f.value=!1}}function h(){a.value={orderDate:new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Taipei"}),customerName:"",customerPhone:"",customerEmail:"",customerAddress:"",orderStatus:"pending",notes:"",orderItems:[{productId:null,productName:"",productSku:"",quantity:1,salePrice:0,totalPrice:0}]},Ce(()=>{p.value?.resetValidation()})}return(d, l)=>(M(),Oe(xe,{modelValue:u.value,"onUpdate:modelValue":l[6]||(l[6]= e=>u.value=e)},{default:y(()=>[n(N,{class:"q-pa-md shadow-4",style:{"min-width":"320px","max-width":"95vw",width:"100%"}},{default:y(()=>[n(z,null,{default:y(()=>l[7]||(l[7]=[o("div",{class:"text-h6"},"新出貨單",-1)])),_:1,__:[7]}),n(Ee),n(z,null,{default:y(()=>[n(Re,{onSubmit:De(C,["prevent"]),class:"q-gutter-sm",ref_key:"formRef",ref:p,loading:f.value},{default:y(()=>[l[8]||(l[8]=o("div",{class:"text-subtitle2 text-grey-7 q-mb-sm"},"客戶資訊",-1)),o("div",Ge,[o("div",Ke,[n(c,{modelValue:a.value.customerName,"onUpdate:modelValue":l[0]||(l[0]= e=>a.value.customerName=e),label:"客戶名稱",dense:"",filled:"",rules:[e=>!!e||"必填"]},null,8,["modelValue","rules"])]),o("div",Ye,[n(c,{modelValue:a.value.customerPhone,"onUpdate:modelValue":l[1]||(l[1]= e=>a.value.customerPhone=e),label:"客戶電話",dense:"",filled:""},null,8,["modelValue"])]),o("div",Je,[n(c,{modelValue:a.value.customerEmail,"onUpdate:modelValue":l[2]||(l[2]= e=>a.value.customerEmail=e),label:"客戶Email",type:"email",dense:"",filled:""},null,8,["modelValue"])])]),o("div",Xe,[o("div",et,[n(c,{modelValue:a.value.customerAddress,"onUpdate:modelValue":l[3]||(l[3]= e=>a.value.customerAddress=e),label:"客戶地址",dense:"",filled:"",type:"text",rows:"2"},null,8,["modelValue"])])]),l[9]||(l[9]=o("div",{class:"text-subtitle2 text-grey-7 q-mb-sm q-mt-md"},"訂單資訊",-1)),o("div",tt,[o("div",lt,[n(c,{modelValue:a.value.orderDate,"onUpdate:modelValue":l[4]||(l[4]= e=>a.value.orderDate=e),label:"訂單日期",type:"date",dense:"",filled:"",rules:[e=>!!e||"必填"]},null,8,["modelValue","rules"])]),o("div",ot,[n(c,{modelValue:a.value.notes,"onUpdate:modelValue":l[5]||(l[5]= e=>a.value.notes=e),label:"備註",dense:"",filled:""},null,8,["modelValue"])])]),l[10]||(l[10]=o("div",{class:"text-subtitle2 text-grey-7 q-mb-sm q-mt-md"},"商品項目",-1)),(M(!0),G(Me,null,Ae(a.value.orderItems,(e, s)=>(M(),G("div",{key:s,class:"q-mb-md"},[n(N,{flat:"",bordered:"",class:"q-pa-md"},{default:y(()=>[o("div",at,[o("div",st,[n(ee,{modelValue:e.productId,"onUpdate:modelValue":[t=>e.productId=t, t=>k(s,t)],label:"商品名稱",options:m.value,"option-value":"productId","option-label":"name",dense:"",filled:"","emit-value":"","map-options":"",rules:[t=>!!t||"必填"]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),o("div",nt,[o("div",rt,[n(c,{modelValue:e.quantity,"onUpdate:modelValue":[t=>e.quantity=t, t=>V(s)],modelModifiers:{number:!0},label:"數量",type:"number",dense:"",filled:"",rules:[t=>t>0||"必須大於 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",dt,[n(c,{modelValue:e.salePrice,"onUpdate:modelValue":[t=>e.salePrice=t, t=>V(s)],modelModifiers:{number:!0},label:"售價",type:"number",step:"0.01",dense:"",filled:"",rules:[t=>t>=0||"必須大於等於 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])])]),o("div",it,[o("div",ut,[n(c,{modelValue:e.totalPrice,"onUpdate:modelValue": t=>e.totalPrice=t,label:"小計",dense:"",filled:"",readonly:"",prefix:"$"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",ct,[n(q,{icon:"delete",color:"negative",flat:"",dense:"",onClick: t=>U(s),disable:a.value.orderItems.length<=1},null,8,["onClick","disable"])])])]),o("div",mt,[o("div",pt,[o("div",vt,[n(ee,{modelValue:e.productId,"onUpdate:modelValue":[t=>e.productId=t, t=>k(s,t)],label:"商品名稱",options:m.value,"option-value":"productId","option-label":"name",dense:"",filled:"","emit-value":"","map-options":"",rules:[t=>!!t||"必填"]},null,8,["modelValue","onUpdate:modelValue","options","rules"])]),o("div",ft,[n(c,{modelValue:e.quantity,"onUpdate:modelValue":[t=>e.quantity=t, t=>V(s)],modelModifiers:{number:!0},label:"數量",type:"number",dense:"",filled:"",rules:[t=>t>0||"必須大於 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",gt,[n(c,{modelValue:e.salePrice,"onUpdate:modelValue":[t=>e.salePrice=t, t=>V(s)],modelModifiers:{number:!0},label:"售價",type:"number",step:"0.01",dense:"",filled:"",rules:[t=>t>=0||"必須大於等於 0"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",ht,[n(c,{modelValue:e.totalPrice,"onUpdate:modelValue": t=>e.totalPrice=t,label:"小計",dense:"",filled:"",readonly:"",prefix:"$",hint:" "},null,8,["modelValue","onUpdate:modelValue"])]),o("div",yt,[n(q,{icon:"delete",color:"negative",flat:"",dense:"",onClick: t=>U(s),disable:a.value.orderItems.length<=1},null,8,["onClick","disable"])])])])]),_:2},1024)]))),128)),n(q,{label:"新增商品項目",icon:"add",color:"secondary",outline:"",onClick:x,class:"q-mb-md full-width-mobile"}),n(N,{flat:"",bordered:"",class:"q-pa-md bg-grey-1"},{default:y(()=>[o("div",bt,[o("div",Vt,"總計：$"+Ne(g.value.toFixed(2)),1)])]),_:1})]),_:1,__:[8,9,10]},8,["loading"])]),_:1}),n(Qe,{align:"right",class:"q-gutter-sm"},{default:y(()=>[n(q,{flat:"",label:"清空",color:"secondary",type:"button",onClick:h,class:"mobile-full-width"}),n(q,{label:"送出",color:"primary",loading:f.value,onClick:C,class:"mobile-full-width"},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ct=ze(_t,[["__scopeId","data-v-4295288a"]]);export{Ut as Q,Ct as S};
