import{d as W,r as u,ag as R,o as U,R as X,S as Y,U as l,a0 as a,f as e,a6 as g,$ as v,W as d,Y as c,X as C,a1 as D,aa as Q}from "./index-CLxRvZYn.js";import{Q as T,a as $,b as n}from "./QTable-B-UTUnxZ.js";import{f as m,h as I}from "./QSelect-BUHZvF4Q.js";import{Q as j}from "./QPage-Bc8lWIhV.js";import{api as G}from "./axios-DLpAuOl3.js";import{u as H}from "./use-quasar-DkPXY9po.js";import{_ as J}from "./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"q-gutter-md"},Z={class:"row q-col-gutter-md"},ee={class:"col-xs-12 col-sm-6 col-md-3"},te={class:"row items-center q-gutter-md"},le={class:"stat-value text-blue-8 q-mt-xs"},ae={class:"col-xs-12 col-sm-6 col-md-3"},oe={class:"row items-center q-gutter-md"},se={class:"stat-value text-red-8 q-mt-xs"},ne={class:"col-xs-12 col-sm-6 col-md-3"},re={class:"row items-center q-gutter-md"},ie={class:"stat-value text-yellow-9 q-mt-xs"},de={class:"col-xs-12 col-sm-6 col-md-3"},ce={class:"row items-center q-gutter-md"},ue={class:"stat-value text-green-8 q-mt-xs"},me={class:"text-h6 text-yellow-9 row items-center"},ge={class:"row items-center"},ve={class:"text-weight-medium"},fe={class:"text-caption text-grey-6"},_e={class:"text-h6 text-red-9 row items-center"},be={class:"row items-center"},xe={class:"text-weight-medium"},we={class:"text-caption text-grey-6"},ye=W({__name:"IndexPage",setup(he){const h=H(),f=u(!0),r=R({sales:0,lowStock:0,expiring:0,orders:0}),i={sales:12e4,lowStock:3,expiring:5,orders:42},_=(s, o, t, y)=>{const w=performance.now(),V=o-s,S= A=>{const O=A-w,k=Math.min(O/t,1),F=1-Math.pow(1-k,4),L=s+V*F;y(L),k<1&&requestAnimationFrame(S)};requestAnimationFrame(S)},M= s=>Math.floor(s).toLocaleString(),b=u([]),x=u([]),p=u(0),q=u(0);async function N(){try{f.value=!0;const o=(await G.get("/dashboard/overview")).data;o?(b.value=o.lowStockItems,x.value=o.expiringBatches,p.value=o.weeklyOrderCount,q.value=o.monthlySales):h.notify({color:"warning",message:"回傳資料為空",icon:"warning",position:"top"})}catch(s){h.notify({color:"negative",message:"獲取儀表板總覽資料失敗",icon:"report_problem",position:"top"}),console.error("Error fetching dashboard overview:",s)}f.value=!1}U(async()=>{await N(),i.sales=q.value,i.lowStock=b.value.length,i.expiring=x.value.length,i.orders=p.value,setTimeout(()=>{_(0,i.sales,1500, s=>{r.sales=s}),_(0,i.lowStock,1e3, s=>{r.lowStock=s}),_(0,i.expiring,1200, s=>{r.expiring=s}),_(0,i.orders,1500, s=>{r.orders=s})},300)});const P=u([{name:"name",label:"商品名稱",field:"name",align:"left"},{name:"batchCode",label:"批次代碼",field:"batchCode",align:"center"},{name:"expirationDate",label:"效期",field:"expirationDate",align:"center"},{name:"quantity",label:"剩餘數量",field:"quantity",align:"center"},{name:"daysToExpiry",label:"剩餘天數",field:"daysToExpiry",align:"center"},{name:"supplierName",label:"供應商",field:"supplierName",align:"left"}]),z=u([{name:"name",label:"商品名稱",field:"name",align:"left"},{name:"availableStock",label:"目前庫存",field:"availableStock",align:"center"},{name:"minStock",label:"最低庫存",field:"minStock",align:"left"},{name:"shortage",label:"缺貨數量",field:"shortage",align:"left"}]),B= s=>{const o=new Date,y=new Date(s).getTime()-o.getTime(),w=Math.ceil(y/(1e3*60*60*24));return w<=3?"red":w<=7?"orange":"yellow"},E= s=>new Date(s).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"});return(s, o)=>(Y(),X(j,{class:"dashboard-page q-pa-md"},{default:l(()=>[a("div",K,[a("div",Z,[a("div",ee,[e(g,{class:"stat-card bg-blue-2",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",te,[e(d,{name:"trending_up",size:"md",class:"text-blue-7"}),a("div",null,[o[0]||(o[0]=a("div",{class:"text-subtitle2 text-grey-7"},"本月銷售總額",-1)),a("div",le," $"+c(M(r.sales)),1)])])]),_:1})]),_:1})]),a("div",ae,[e(g,{class:"stat-card bg-red-2",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",oe,[e(d,{name:"inventory_2",size:"md",class:"text-red-7"}),a("div",null,[o[1]||(o[1]=a("div",{class:"text-subtitle2 text-grey-7"},"低庫存商品",-1)),a("div",se,c(Math.floor(r.lowStock))+" 項 ",1)])])]),_:1})]),_:1})]),a("div",ne,[e(g,{class:"stat-card bg-yellow-2",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",re,[e(d,{name:"schedule",size:"md",class:"text-yellow-9"}),a("div",null,[o[2]||(o[2]=a("div",{class:"text-subtitle2 text-grey-7"},"即將過期",-1)),a("div",ie,c(Math.floor(r.expiring))+" 批 ",1)])])]),_:1})]),_:1})]),a("div",de,[e(g,{class:"stat-card bg-green-1",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",ce,[e(d,{name:"receipt",size:"md",class:"text-green-7"}),a("div",null,[o[3]||(o[3]=a("div",{class:"text-subtitle2 text-grey-7"},"本週訂單數",-1)),a("div",ue,c(Math.floor(r.orders))+" 張 ",1)])])]),_:1})]),_:1})])]),e(g,{class:"q-mt-md bg-yellow-1",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",me,[e(d,{name:"warning",class:"q-mr-sm"}),o[4]||(o[4]=C(" 即將過期商品批次 ")),e(T),e(m,{color:"yellow-8","text-color":"white",label:`${x.value.length} 批次`,dense:""},null,8,["label"])])]),_:1}),e(D),e($,{flat:"",dense:"",rows:x.value,columns:P.value,"row-key":"batchCode",class:"expiring-table","rows-per-page-options":[5,10,20],pagination:{rowsPerPage:5},"no-data-label":"暫無即將過期商品",loading:f.value},{"body-cell-expirationDate":l(t=>[e(n,{props:t},{default:l(()=>[e(m,{color:B(t.value),"text-color":"white",dense:"",label:E(t.value),icon:t.row.daysToExpiry<=3?"priority_high":"schedule"},null,8,["color","label","icon"])]),_:2},1032,["props"])]),"body-cell-quantity":l(t=>[e(n,{props:t},{default:l(()=>[e(I,{color:t.value<10?"red":t.value<50?"orange":"green",label:`${t.value} 件`,class:"q-px-sm"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-daysToExpiry":l(t=>[e(n,{props:t},{default:l(()=>[e(m,{color:t.value<=3?"red":t.value<=7?"orange":"yellow","text-color":"white",dense:"",label:`${t.value} 天`,icon:t.value<=3?"error":"schedule"},null,8,["color","label","icon"])]),_:2},1032,["props"])]),"body-cell-name":l(t=>[e(n,{props:t},{default:l(()=>[a("div",ge,[e(Q,{size:"sm",color:"grey-3","text-color":"grey-8",class:"q-mr-sm"},{default:l(()=>[e(d,{name:"inventory"})]),_:1}),a("div",null,[a("div",ve,c(t.value),1),a("div",fe,"批次: "+c(t.row.batchCode),1)])])]),_:2},1032,["props"])]),"body-cell-supplierName":l(t=>[e(n,{props:t},{default:l(()=>[e(m,{color:"grey-3","text-color":"grey-8",dense:"",label:t.value,icon:"business"},null,8,["label"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1}),e(g,{class:"q-mt-md bg-red-1",flat:"",bordered:""},{default:l(()=>[e(v,null,{default:l(()=>[a("div",_e,[e(d,{name:"inventory_2",class:"q-mr-sm"}),o[5]||(o[5]=C(" 低庫存商品警示 ")),e(T),e(m,{color:"red-8","text-color":"white",label:`${b.value.length} 項商品`,dense:""},null,8,["label"])])]),_:1}),e(D),e($,{flat:"",dense:"",rows:b.value,columns:z.value,"row-key":"name",class:"low-stock-table","rows-per-page-options":[5,10,20],pagination:{rowsPerPage:5},"no-data-label":"暫無低庫存商品",loading:f.value},{"body-cell-name":l(t=>[e(n,{props:t},{default:l(()=>[a("div",be,[e(Q,{size:"sm",color:"red-2","text-color":"red-8",class:"q-mr-sm"},{default:l(()=>[e(d,{name:"inventory"})]),_:1}),a("div",null,[a("div",xe,c(t.value),1),a("div",we,"ID: "+c(t.row.productId),1)])])]),_:2},1032,["props"])]),"body-cell-availableStock":l(t=>[e(n,{props:t},{default:l(()=>[e(I,{color:t.value<10?"red":t.value<30?"orange":"green",label:`${t.value} 件`,class:"q-px-sm"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-minStock":l(t=>[e(n,{props:t},{default:l(()=>[e(m,{color:"grey-4","text-color":"grey-8",dense:"",label:`${t.value} 件`,icon:"inventory_2"},null,8,["label"])]),_:2},1032,["props"])]),"body-cell-shortage":l(t=>[e(n,{props:t},{default:l(()=>[e(m,{color:t.value>20?"orange":"red","text-color":"white",dense:"",label:`缺 ${t.value} 件`,icon:"trending_down"},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})])]),_:1}))}}),Te=J(ye,[["__scopeId","data-v-f7b3a990"]]);export{Te as default};
